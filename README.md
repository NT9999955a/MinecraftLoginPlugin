# 登录插件 (LoginPlugin) - 使用文档

## 插件简介

LoginPlugin 是一个为 Spigot 1.12.2 服务器设计的轻量级登录插件，提供完整的玩家身份验证系统。插件采用单文件实现，易于部署和维护。

## 功能特点

- ✅ **玩家注册与登录系统**
- ✅ **密码加密存储**（SHA-256）
- ✅ **会话管理**（自动超时登出）
- ✅ **未登录玩家限制**（移动、交互、聊天等）
- ✅ **密码修改功能**
- ✅ **可配置的安全策略**
- ✅ **简单易用的命令系统**

## 安装方法

1. 将 `LoginPlugin.jar` 文件放入服务器的 `plugins` 文件夹
2. 启动服务器，插件会自动生成配置文件
3. 根据需要编辑 `plugins/LoginPlugin/config.yml`
4. 重启服务器或使用重载命令

## 配置文件说明

配置文件位置：`plugins/LoginPlugin/config.yml`

```yaml
# 是否启用登录系统
require-login: true

# 登录前是否允许移动
allow-movement-before-login: false

# 最大登录尝试次数
max-login-attempts: 3

# 会话超时时间（分钟）
session-timeout-minutes: 30
```

### 配置选项说明

- **require-login**: 
  - `true`: 启用登录系统（默认）
  - `false`: 禁用登录系统，玩家可以直接游戏

- **allow-movement-before-login**:
  - `false`: 未登录玩家无法移动（默认）
  - `true`: 未登录玩家可以移动，但不能进行其他操作

- **max-login-attempts**: 
  - 设置密码错误的最大尝试次数，超过次数会被踢出服务器
  - 默认值：3

- **session-timeout-minutes**:
  - 玩家登录后的会话持续时间
  - 超过时间未活动需要重新登录
  - 默认值：30分钟

## 命令使用

### 玩家命令

| 命令 | 权限 | 描述 | 用法 |
|------|------|------|------|
| `/login` | 所有玩家 | 登录账号 | `/login <密码>` |
| `/register` | 所有玩家 | 注册账号 | `/register <密码> <确认密码>` |
| `/changepassword` | 所有玩家 | 修改密码 | `/changepassword <原密码> <新密码>` |

### 管理员命令

| 命令 | 权限 | 描述 | 用法 |
|------|------|------|------|
| `/loginreload` | `loginplugin.reload` | 重载插件配置 | `/loginreload` |

## 权限节点

| 权限节点 | 描述 | 默认 |
|----------|------|------|
| `loginplugin.reload` | 允许重载插件配置 | OP |

## 使用流程

### 新玩家首次加入

1. 玩家加入服务器
2. 看到注册提示信息
3. 使用 `/register 密码 确认密码` 注册账号
4. 注册成功后自动登录

### 已注册玩家登录

1. 玩家加入服务器
2. 看到登录提示信息
3. 使用 `/login 密码` 登录
4. 登录成功后可以正常游戏

### 修改密码

1. 已登录玩家使用 `/changepassword 原密码 新密码`
2. 密码修改成功后立即生效

## 安全特性

### 密码安全
- 所有密码使用 SHA-256 加密存储
- 原始密码不会以任何形式保存在文件中
- 密码最小长度为4位

### 会话安全
- 登录后会有会话超时保护
- 长时间不活动会自动登出
- 登录尝试次数限制防止暴力破解

### 行为限制
未登录玩家受到以下限制：
- ❌ 移动（可配置）
- ❌ 破坏/放置方块
- ❌ 与实体/物品交互
- ❌ 打开容器
- ❌ 使用聊天功能
- ❌ 使用非登录相关命令
- ❌ 受到/造成伤害

## 数据存储

玩家数据存储在 `plugins/LoginPlugin/players.yml` 文件中，包含：
- 加密的密码哈希
- 注册时间
- 最后活动时间
- 其他账户信息

## 故障排除

### 常见问题

**Q: 玩家无法移动怎么办？**
A: 检查配置文件中的 `allow-movement-before-login` 设置，如果为 `false`，玩家需要先登录才能移动。

**Q: 忘记密码怎么办？**
A: 目前没有提供密码重置功能，需要管理员手动在 `players.yml` 中删除对应玩家的数据，让玩家重新注册。

**Q: 插件无法加载？**
A: 确保服务器运行的是 Spigot 1.12.2，检查控制台错误信息。

**Q: 配置修改不生效？**
A: 使用 `/loginreload` 重载配置或重启服务器。

### 日志信息

插件会在控制台输出重要操作日志：
- 插件启用/禁用状态
- 配置文件创建
- 玩家数据保存
- 错误信息（如有）

## 开发者信息

- **插件名称**: LoginPlugin
- **适用版本**: Spigot 1.12.2
- **开发语言**: Java
- **代码结构**: 单文件实现

## 更新日志

### v1.0.0
- 初始版本发布
- 基础登录/注册功能
- 配置文件系统
- 玩家行为限制

## 技术支持

如有问题或建议，请联系插件开发者或查看服务器日志获取详细信息。

---

**注意**: 请定期备份玩家数据文件，防止意外数据丢失。
